import torch
from transformers import AutoTokenizer, AutoModelForCausalLM

model_name = "Qwen/Qwen2.5-0.5B-Instruct"

print("모델 로딩 중...")
tokenizer = AutoTokenizer.from_pretrained(model_name)
model = AutoModelForCausalLM.from_pretrained(
    model_name,
    dtype=torch.float16,
    device_map="auto"
)
print("모델 로딩 완료!")

system_prompt = """너는 뉴스를 요약해주는 어시스턴트이다.
요약 대상 독자는 시사 정보를 알고 싶어하는 대학생이다.

요약 시 다음 원칙을 반드시 지켜라:
- 어려운 정치·경제·사회 용어는 쉬운 말로 바꿔 설명한다.
- 핵심 정보만 간결하게 전달한다.
- 중립적인 관점에서 사실 위주로 서술한다.
- 한국어로만 정리한다.
- Positive 에는 뉴스 기사에 대한 내용에서 정책의 장점,혹은 찬성 입장 등 100자 내외로 정리하고
- Negative 에는 뉴스 기사에 대한 내용에서 정책의 단점,우려사항, 혹은 반대 입장 등 100자 내외로 요약한다.

출력은 반드시 지정된 형식을 그대로 사용하고,
다른 문장이나 설명을 추가하지 마라."""

# 크롤링된 내용을 요약하는 부분
def summarize_content(content: str):
    user_prompt = f"""아래 뉴스 기사를 요약해줘.

요구 사항:
1. 전체 내용은 400자 내외로 작성해줘.
2. 아래 형식을 반드시 지켜줘.
3. 각 항목은 문장 형태로 작성해줘.

출력 형식:
[ 1. 요약 내용(200자 내외):
---
2. Positive :
---
3. Negative :
]

다음은 뉴스 내용이야.
{content}"""

    # Qwen2.5의 채팅 형식
    messages = [
        {"role": "system", "content": system_prompt},
        {"role": "user", "content": user_prompt}
    ]

    # 토크나이저에 채팅 템플릿 적용
    text = tokenizer.apply_chat_template(
        messages,
        tokenize=False,
        add_generation_prompt=True
    )
    
    model_inputs = tokenizer([text], return_tensors="pt").to(model.device)
    
    print("요약 시작...")
    
    generated_ids = model.generate(
        **model_inputs,
        max_new_tokens=512,
        do_sample=True,
        temperature=0.6,
        top_p=0.9,
        pad_token_id=tokenizer.eos_token_id
    )
        
    generated_ids = [
        output_ids[len(input_ids):] 
        for input_ids, output_ids in zip(model_inputs.input_ids, generated_ids)
    ]
    
    response = tokenizer.batch_decode(generated_ids, skip_special_tokens=True)[0]
    return response

if __name__ == "__main__":
    print(summarize_content("""아직 끝나지 않은 협상
사실 미국 측이 한국과 타결한 무역 합의를 근거로 압박을 해오는 분야는 ‘투자 속도’ 뿐은 아니에요. 실제로 지난해 11월 양국이 무역 합의에 관한 공동 설명 자료를 발표한 후에도 양국 간 갈등이 커질 수 있는 요소들이 여럿 꼽혀왔거든요.
대표적인 게 ‘디지털 규제 장벽’이에요. 한국의 온라인플랫폼법(온플법), 망 사용료, 고정밀 지도 반출 등은 미국이 예민하게 반응하는 분야죠. 미국 측은 얼마 전에도 한국 정부에 “공동 합의에 담겼던 ‘한국에서 사업하는 미국 빅테크를 한국 기업과 차별하지 않는다’라는 약속을 지켜달라”는 내용의 서한을 보냈다고 해요.

물론 한국 정부는 이런 현안들이 트럼프 대통령의 ‘관세율 재인상 선언’과는 직접적 관련이 없다고 보고 있지만, 다시 미국과의 협의에 나서야 할 상황에서 기민하게 반응해야 할 문제인 건 사실이에요. 미국이 가진 여러 분야의 불만을 모두 고려할 필요가 있겠죠. 당장 우리 정부는 관세율을 다시 올리겠다는 미국의 위협에 대응하기 위해 김정관 산업통상부 장관을 미국으로 보냈는데도, 아직 합의점을 찾지 못했어요.

미국이 싫어하는 디지털 장벽
앞으로 미국과의 관계에서 꽤 중요하게 여겨질 ‘디지털 규제 장벽’이란 건 도대체 뭘까요? 오늘은 미국 측이 ‘디지털 장벽’으로 지목한 현안을 깔끔하게 정리해 봤어요. 꽤 오랫동안 중요한 문제로 여겨지는 만큼 한방에 정리해 두시면 좋을 것 같아요.
① 망 사용료 부과 논쟁

‘망 사용료’란 구글·넷플릭스 등 막대한 양의 콘텐츠를 제공하는 거대 사업자들이 통신사에 인터넷망 사용의 대가로 지급하는 돈을 말하는데, 실제로는 지급하지 않고 있어요. 구글이나 넷플릭스도 이미 인터넷 접속료는 내고 있어서 ‘왜 망 사용료를 별도로 내야 하느냐’고 맞서고 있기 때문이에요.
                            망 사용료는 평범한 개인이나 기업들이 인터넷을 쓰기 위해 내는 ‘인터넷 접속료’와 조금 달라요. 우리가 넷플릭스에서 영화를 볼 때, 데이터는 한국 통신사와 미국 통신사를 모두 거쳐요. 넷플릭스가 미국 통신사에 영화를 보내면, 그걸 미국 통신사가 일종의 허브 역할을 하는 여러 통신사를 거쳐서 다시 한국 통신사에 보내고, 그 영화를 우리가 보는 거죠.
조금 복잡하지만, 국제 택배가 중간에 허브 물류창고들을 거치는 것과 비슷하다고 보면 돼요. 이렇게 데이터가 미국 통신사에서 허브를 거쳐 한국 통신사로 넘어올 때의 비용은 ‘상호 접속료’라고 하는데요. 이 돈은 소비자나 유튜브가 내지 않고 한국과 미국의 통신사끼리 정산해 왔어요.
                            
                            ② 국내 고정밀 지도 반출

구글 지도는 유독 한국에서 네이버나 카카오의 경쟁 서비스에 비해 기능이 좋지 않아요. 고정밀 지도 정보를 이용하지 못하기 때문이에요. 구글은 한국 정부에 ‘고정밀 지도를 해외에 있는 구글 데이터센터에서 사용할 수 있게 해달라’고 오래전부터 요청해 왔지만, 안보상 위험을 이유로 한국 정부는 정밀한 지도 데이터의 해외 반출을 거부했어요. 정밀한 지도가 구글의 자체 인공위성 데이터로 만든 지도와 결합하면, 우리나라 주요 안보 시설을 아주 정밀하게 파악할 수 있다고 본 거예요.

구글이 해외에 있는 데이터센터로 가져가 다룰 수 있게 해달라고 요청한 데이터는 ‘1대 5000 축척 지도’예요. 1대 5000 지도는 실제 50미터를 지도에 1cm로 표현하는 지도인데, 골목길까지 자세히 들여다볼 수 있는 수준이에요. 현재 구글이 한국에서 구글 지도에 쓰고 있는 데이터는 ‘1대 2만 5000 축척 지도’여서 상대적으로 정밀도가 낮아요.

미국 캘리포니아주에 위치한 구글 본사. /사진=연합뉴스

미국 캘리포니아주에 위치한 구글 본사. /사진=연합뉴스
한국 정부는 구글이 한국에 데이터센터를 설치해서 해외로 데이터를 가져가지 않고 활용하거나, 군사 시설 등 보안 시설을 가림(블러) 처리해서 해외로 가져가 쓰는 방법을 제안했어요. 구글은 이 제안을 거절했고요. 이후 정부는 고정밀 지도 반출을 계속 거부해 왔어요.
구글은 최근 들어 더 적극적으로 고정밀 지도 반출을 요청하고 있어요. 기존엔 거절했던 보안 시설의 가림 처리 조치도 받아들이겠다며 데이터를 다시 요청하는 모습이에요. 전문가들은 자율주행 등 첨단 기술에 활용하려는 것으로 보고 있어요.

미국 정부는 안보상 필요로 제한하는 고정밀 지도 데이터 반출 규제가 미국 기업에 대한 차별이라고 주장해요. 구글이 가림 처리 등에 응했고, 관세 위협도 거센 만큼 조만간 반출이 허용될 수 있다는 예상도 나와요.

③ 온라인플랫폼법 제정

‘온라인플랫폼법’도 미국이 거부감을 드러내는 대표적 디지털 규제 중 하나예요. 아직 제정되지도 않은 법이고, 초기 구상보다 많이 완화된 규제로 수정돼 추진 중임에도 미국이 강하게 반대해 아직 법제화되지 못했어요.

온라인플랫폼법은 거대 정보기술(IT) 플랫폼들이 특정 산업을 독점하지 못하게 더욱 철저히 감시하는 내용을 담고 있어요. 플랫폼 시장은 독과점화가 빠른 특성이 있고, 이후에는 새로운 업체가 성장하기 힘들기 때문이에요. 한국에 들어온 미국 기업의 규모와 영향력을 고려하면, 구글과 애플 등 주요 IT 기업은 대부분 규제받게 돼요. 국내 기업 중엔 이 정도 영향력을 갖춘 기업이 많지 않아서 네이버와 카카오 정도만 규제 대상이 될 것으로 예상된대요. 미국이 반길 리 없겠죠.

‘불똥 튈라’ 걱정하는 기업들
구글, 애플, 넷플릭스 등 미국의 세계적 IT 기업들이 세계 각국에 발휘하는 영향력은 엄청나요. 영향력이 큰 만큼 각국 정부들은 이 기업들이 소비자와 국가 경제에 악영향을 미치지 않도록 견제하고 싶어 하죠. 우리도 앞서 언급한 몇몇 디지털 규제들로 그런 장치들을 마련하려 한 거고요.
하지만 미국의 반발을 고려하면, 쉽게 의도대로 되진 않을 것 같아요. 국내 IT 기업들은 ‘외국 기업을 규제하려다 한국 기업만 불리해지는 게 아니냐’는 걱정까지 하는 분위기라고 해요. 여러 규제를 만들었는데, 막상 미국 정부의 압박에 못 이겨 미국 기업에는 제대로 적용하지 못할 수 있다고 우려하는 거예요.

이제는 지나갔다고 생각했던 ‘관세 칼날’의 위협은 여전히 우리를 겨누고 있어요. 관세율은 합의한 대로 유지될지 모르지만, 그 과정에서 미국에 어떤 것들을 내어줘야 할지 쉽게 예상하기 힘들어요. 지난해 비교적 합리적인 협상 결과를 끌어냈다고 평가받은 한국 정부, 다가올 협상들에서도 선전할 수 있을까요?"""))
